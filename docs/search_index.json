[["index.html", "Rを用いて基礎から応用まで学ぶGLM・GLMM入門 0 本稿の目的 0.1 なぜGLMやGLMMについて学ぶ必要があるのか？ 0.2 本稿で扱う内容", " Rを用いて基礎から応用まで学ぶGLM・GLMM入門 Tsubasa Yamaguchi 2023-12-05 0 本稿の目的 0.1 なぜGLMやGLMMについて学ぶ必要があるのか？ 近年、生態学や動物行動学をはじめ、複雑な生物学のデータを解析する手法が発達してきています(Harrison et al., 2018)。これは、従来のシンプルな統計手法(e.g. t検定、\\(\\chi ^2\\)検定、相関検定、ウィルコクソンの検定など)では、これらの分野で扱う複雑なデータを分析するには不適切であることが分かってきているからです。 様々な分析のなかでも、線形モデル(linear model)や線形混合モデル(linear mixed model)、およびこれらを様々な分布のデータに拡張した一般化線形モデル(generalized linear model)や一般化線形混合モデル(generalized linear mixed model)などは2000年代以降急速に用いられるようになってきています(Bolker et al., 2009; Fox et al., 2015; Zuur, 2009; 大東, 2010)。図0.1は、Google Scholarを用いて、動物行動学・生態学・霊長類学の分野で著名な学術雑誌において、“linear model”、“linear mixed model(LMM)”、“generalized linear model (GLM)”、“generalized linear mixed model (GLMM)”、という単語が出てきた論文の割合を示したものです(2023年8月18日時点)。私たちが普段読む/投稿することが多いこれらの雑誌においても、2000年代以降これらの分析手法が数多く使われるようになってきたことが示唆されます(特に行動学系では)。同様の分析に異なる名称が用いられていることもある(e.g., “ANOVA”、“ANCOVA”、“linear regression”など)ことを考慮すると、実際の割合はもっと高くなるはずです。 図0.1: GLMやGLMMなどの単語を含む論文の割合 このことは、もはやこれらの分析についてきちんと理解しなければ、多くの論文の分析結果を適切に解釈できないということを示します。分析への理解が不十分であれば、仮に論文の著者が分析を誤用していたり、分析結果を誤って解釈していたりしても(実際にそのような論文はある)、論文の内容を鵜呑みして引用してしまうことになりかねません。これは大きな問題です。 またこうした流れの中で、私たち自身も論文を執筆する際に、これらの分析を使用することを求められることがますます増えていくのではないかと予想されます。そのとき、GLMやGLMMについてあまり理解しないままに分析を行えば、自身のデータに対して不適切な分析を行ってしまったり、分析結果を誤って解釈してしまったりするかもしれません。 以上のことから、本稿はGLM/GLMMが用いられた分析結果について適切に理解できるようになることに加え、可能であればRを用いて自身のデータについてもGLM/GLMMを用いた分析ができるようになることを目標に作成されました。私自身まだ理解が及ばないところもありますが、本稿を読んで皆様のお役に少しでも立てれば幸いです。 0.2 本稿で扱う内容 本稿で扱うのは、以下の内容です。 確率と統計の基本 統計モデリングとは何か 一般化線形モデル(GLM) 一般化線形混合モデル(GLMM) 結果の診断と統計検定 モデル選択 発展的なモデル(ゼロ過剰モデル、ハードルモデル) 参考にしたのは主に以下の文献です。特に日本語で示した文献は、GLMやGLMMの入門としてはうってつけだと思います。 なお、本稿の作成に使用したファイルとRのコードは筆者のGithubですべて閲覧できます。 馬場真哉(2015) 平均・分散から始める一般化線形モデル入門 (馬場, 2015) 粕谷英一(2012) 一般化線形モデル (松浦, 2012) Gelman et al. (2020) Regression and Other Stories (Gelman et al., 2020) Fox et al. (2015) Ecological Statistics: Contemporary Theory and Application (Fox et al., 2015) Dunn &amp; Smyth (2018) Generalized Linear Models with Examples in R (Dunn &amp; Smyth, 2018) 馬場真哉(2019) RとStanではじめるベイズ統計モデリングによるデータ分析 (馬場, 2019) 松浦健太郎(2016) StanとRでベイズ統計モデリング (松浦, 2016) McElreath, R (2020) Statistical Rethinking (McElreath, 2009) 本稿はRの基本操作とtidyverseパッケージによるデータハンドリングができることを前提としています。tidyverseパッケージを用いたデータ処理については、以下の書籍などを参照してください。 R for Data Science (Wickham &amp; Grolemund, 2016) 電子書籍, 日本語 R Graphics Coocbook 2nd Edition (Chang, 2018) 電子書籍, 日本語 RユーザのためのRstudio[実践]入門~tidyverseによるモダンな分析フローの世界 改訂2版 (松村 et al., 2021) 出版社サイト References Bolker, B. M., Brooks, M. E., Clark, C. J., Geange, S. W., Poulsen, J. R., Stevens, M. H. H., &amp; White, J. S. S. (2009). Generalized linear mixed models: A practical guide for ecology and evolution. In Trends in Ecology and Evolution (No. 3; Vol. 24, pp. 127–135). Chang, W. (2018). R graphics cookbook: Practical recipes for visualizing data. “O’Reilly Media, Inc.” Dunn, P. K., &amp; Smyth, G. K. (2018). Generalized linear models with examples in R. Springer New York. Fox, G. A., Negrete-Yankelevich, S., &amp; Sosa, V. J. (2015). Ecological statistics: Contemporary theory and application. Oxford University Press. Gelman, A., Hill, J., &amp; Vehtari, A. (2020). Regression and other stories. Cambridge University Press. Harrison, X. A., Donaldson, L., Correa-Cano, M. E., Evans, J., Fisher, D. N., Goodwin, C. E. D., Robinson, B. S., Hodgson, D. J., &amp; Inger, R. (2018). A brief introduction to mixed effects modelling and multi-model inference in ecology. PeerJ, 2018(5). McElreath, R. (2009). Statistical rethinking: A bayeasian course with example in r and stan. CRC Press. Wickham, H., &amp; Grolemund, G. (2016). R for data science: Import, tidy, transform, visualize, and model data. “O’Reilly Media, Inc.” Zuur, A. F. (2009). Mixed effects models and extensions in ecology with R. Springer. 大東健太郎. (2010). 線形モデルから一般化線形モデル（GLM）へ. 雑草研究, 55(4), 268–274. 松村優哉., 湯谷啓明., 紀ノ定保礼., &amp; 前田和. (2021). RユーザのためのRstudio[実践]入門 tidyverseによるモダンな分析フローの世界 改訂2版. 技術評論社. 松浦健太郎. (2012). StanとRでベイズ統計モデリング. 共立出版. 松浦健太郎. (2016). StanとRでベイズ統計モデリング. 共立出版. 馬場真哉. (2015). 平均・分散から始める一般化線形モデル入門. プレアデス出版. 馬場真哉. (2019). RとStanではじめるベイズ統計モデリングによるデータ分析. 講談社. "],["パッケージの読み込み.html", "0. パッケージの読み込み", " 0. パッケージの読み込み 分析のため、以下のパッケージを読み込みます。本稿では、基本的にGLMにはRにもともと実装されているglm()関数を、GLMMにはglmmTMBパッケージ(Brooks et al., 2017)を用います。 ## データハンドリング library(tidyverse) library(easystats) library(data.table) ## グラフや表関連 library(patchwork) library(lemon) library(DT) library(knitr) library(kableExtra) library(dagitty) library(ggdag) library(ggforce) library(concaveman) library(ggsci) ## フォント関連 library(extrafont) require(systemfonts) ## モデリング library(glmmTMB) library(rethinking) library(brms) library(DHARMa) library(DHARMa.helpers) library(rstan) rstan_options(auto_write = TRUE) options(mc.cores = parallel::detectCores()) References Brooks, M. E., Kristensen, K., van Benthem, K. J., Magnusson, A., Berg, C. W., Nielsen, A., Skaug, H. J., Maechler, M., &amp; Bolker, B. M. (2017). glmmTMB balances speed and flexibility among packages for zero-inflated generalized linear mixed modeling. The R Journal, 9(2), 378–400. https://doi.org/10.32614/RJ-2017-066 "],["c1.html", "1 統計モデリングとは 1.1 本章の内容 1.2 データ分析の二つの目的 1.3 統計モデリングの必要性 1.4 一般化線形モデル", " 1 統計モデリングとは 1.1 本章の内容 GLMやGLMMは、統計モデリングと呼ばれる分析手法の一種です。本章では、まず統計モデリングとは何かを説明します。 1.2 データ分析の二つの目的 研究活動において、データ分析は必要不可欠です。事例的な研究や統計分析がなくても結果が明確な場合を除けば、他人に説得力のある形で自身の研究結果を提示するためにはデータ分析が必要になります。 データ分析の目的としては、大きく分けて現象の解釈(= 現象の理由や仕組みが知りたい！)と将来の予測(これまでに得られたデータから未来のふるまいを予測したい！)の2つが設定されることが多いです(松浦, 2016; 馬場, 2019)。 現象の解釈 ニホンザルの遊びについて分析することで、どのような要因が遊び時間割合に影響するか探る 喫煙の有無と病歴を分析することで、喫煙が健康に及ぼす影響を探る 将来の予測 生物の個体数とそれに影響する要因を分析することで、将来の個体数を予測する。 株価の変動を分析することで、今後の株式市場の動きを予測する。 1.3 統計モデリングの必要性 これらの目的を達成するために、統計モデリングは非常に有用な手法です(松浦, 2016)。統計モデリングは、複雑な問題に対しても解釈がしやすいうえに、予測性能も高いという大きな利点を持っているからです。 モデルとは、「不必要な性質を無視して、必要なエッセンスだけを取り上げたもの」(松浦, 2016)です。例えば、「プラモデル」は本物の車や飛行機の実際の重さ・材質・機能を無視し、形や色のみに着目して作成したものです。モデルを作る行為をモデリングといいます。 モデルのなかでも、そのエッセンスを記述するのに数式を使ったものが数理モデルであり、さらに確率的な表現を取り入れた数理モデルを確率モデルといいます。統計モデリングとは、実際のデータに確率モデルを当てはめて、現象の解釈や予測をおこなうことを指します。具体的に統計モデリングは以下の手順で行われます。 観測したデータが生み出された過程を確率的に表現する データからモデルの推定を行う 推定されたモデルを考察することで現象の解釈や予測を行う 1.4 一般化線形モデル 統計モデルの中でもある程度複雑なモデルを作ることができ、かつ解釈がしやすいために非常によく用いられるのが一般化線形モデル(Generlized linear model: GLM)です。本稿では、主に一般化線形モデルとそれを少し発展された手法である一般化線形混合モデル(Generalized linear mixed model)について解説を行います。 References 松浦健太郎. (2016). StanとRでベイズ統計モデリング. 共立出版. 馬場真哉. (2019). RとStanではじめるベイズ統計モデリングによるデータ分析. 講談社. "],["c3.html", "2 確率分布の基礎 2.1 確率分布とは 2.2 確率分布とパラメータ 2.3 連続変数と離散変数 2.4 連続型の確率分布 2.5 離散型の確率分布", " 2 確率分布の基礎 2.1 確率分布とは 前章(1)において、統計モデルでは「データに確率モデルを当てはめて、現象の解釈や予測をおこなう」と書きました。確率モデルの記述に必要になってくるのが確率分布です。確率分布は、確率変数とそれが得られる確率との対応を表したものです。確率変数とは、確率的な法則に従って値がランダムに変化する値のことを表します。統計学では、データが確率的な過程によって得られると仮定するので、データは確率変数です。 確率変数: 確率的な法則に従って値がランダムに変化する値(e.g., データ) 確率分布: 確率変数とそれが得られる確率との対応を表したもの 2.2 確率分布とパラメータ 確率分布はパラメータ(母数)によって形が決まります。後述しますが、例えば正規分布はその期待値(=平均)\\(\\mu\\)と分散\\(\\sigma^2\\)によって形が決まります(図2.1)。統計モデルでは、データから確率分布のパラメータを推定することになります。 図2.1: 様々な正規分布 2.3 連続変数と離散変数 確率変数には連続型なものと離散型なものがあります。連続型の変数は、雑に言ってしまえば小数点以下をとることができ、計測を精密にすればするほどより細かい値が得られるものを指します(e.g., 体重、気温)。一方で離散型の変数は、\\(1,2,3,\\dots\\)のように小数点以下の値をとりえない量的な変数(e.g., 発生回数など)や質的な変数(e.g., オス/メス、大/中/小)のことを指します。 連続型: 小数点以下をとることができる量的な変数(e.g., 体重、気温) 離散型: 小数点以下の値をとりえない量的な変数/質的変数(e.g., 発生回数、大/中/小) 確率分布は連続的か離散的かなど、確率変数がどのようなものかによって変わります。以下では、実際にどのような確率分布があるか見ていきましょう。 2.4 連続型の確率分布 連続型の量的データを対象とする際には、連続型の確率分布を用います。確率分布は、確率密度関数によって表されます。確率密度関数を\\(f(x)\\)とするとき、確率変数がa以上b以下の値をとる確率は以下のように表されます。確率密度関数は複雑な数式で表されますが、覚える必要はありません。 \\[ \\int_a^b f(x) dx \\] それでは、実際に連続型の確率分布の例を見ていきましょう。 2.4.1 正規分布 正規分布はガウス分布とも呼ばれ、平均値に対して左右対称な釣り鐘型になります。正規分布は先ほど触れたように期待値\\(\\mu\\)と分散\\(\\sigma^2\\)という2つのパラメータによって形が決まり、確率密度関数は以下のようになります。 期待値: \\(\\mu\\) 分散: \\(\\sigma^2\\) \\[ P(x) = \\frac{1}{\\sqrt{2 \\pi \\sigma^2}}exp(-\\frac{(x-\\mu)^2}{2\\sigma^2}) \\] \\(\\mu\\)と\\(\\sigma^2\\)の値を変えたときの分布の形は図2.1に示した通りです。 2.4.2 コーシー分布 コーシー分布も左右対称な釣り鐘型になりますが、正規分布よりが裾の長いという特徴を持ちます。\\(\\mu\\)と\\(\\sigma\\)という2つのパラメータによって形が決まり、確率密度関数は以下のようになります。なお、コーシー分布は期待値と分散が存在しない特殊な分布です。 \\[ P(x) = \\frac{1}{\\pi\\sigma} \\frac{1}{1 + ((x - \\mu)/\\sigma)^2} \\] \\(\\mu\\)と\\(\\sigma\\)の値を変えたときの分布の形は図2.2の通りです。正規分布よりも裾が長いことが分かります。 図2.2: 様々なコーシー分布 2.4.3 Studentのt分布 Studentのt分布も前出の2つと同様に左右対称な釣り鐘型になります。\\(\\mu\\)、\\(\\sigma\\)、\\(\\nu\\)(自由度)という3つのパラメータがあり、確率密度関数は以下のようになります。なお、\\(\\Gamma()\\)はガンマ関数を表します。自由度\\(\\nu\\)の値によって分布の裾の長さが決まり、\\(\\nu = 1\\)のときはコーシー分布と、\\(\\nu = \\infty\\)のときは正規分布と一致します。つまり、自由度が大きいほど裾の狭い分布になります。 \\[ P(x) = \\frac{\\Gamma((\\nu + 1)/2)}{\\Gamma(\\nu/2)\\sqrt{pi\\nu\\sigma}} \\Bigl(1 + \\frac{1}{\\nu} \\bigl(\\frac{x - \\mu}{\\sigma} \\bigl)^2 \\Bigl)^{-(x+1)/2} \\] 分布の期待値と分散は以下のようになります。 期待値:\\(\\nu &gt; 1\\)ならば\\(\\mu\\)、それ以外は存在しない 分散: \\(\\nu &gt; 2\\)ならば\\(\\sigma^2\\nu/(\\nu-2)\\)、\\(1 &lt; \\nu \\le 2\\)の場合は\\(\\infty\\)、それ以外は存在しない パラメータを変化させたときの分布の変化は以下の通りです(図2.3)。なお、全て\\(\\mu = 0\\)です。なお、確率密度関数の算出はこのページを参照しました。 図2.3: 様々なStudentのt分布 2.4.4 ガンマ分布 ガンマ分布は正の値のみをとる連続型の量的データに用いられる分布です。\\(\\alpha\\)と\\(\\beta\\)という2つのパラメータをとり、確率密度関数は以下のようになります。\\(\\alpha\\)は形状(shape)パラメータ、\\(\\beta\\)はrateパラメータと呼ばれます。 \\[ P(x) = \\frac{\\beta^\\alpha}{\\Gamma(\\alpha)} x^{\\alpha-1} exp(-\\beta x) \\] 分布の期待値と分散は以下のようになります。 期待値: \\(\\alpha/\\beta\\) 分散: \\(\\alpha/\\beta^2\\) パラメータを変化させたときの分布の変化は以下の通りです(図2.4)。 図2.4: 様々なガンマ分布 2.4.5 ベータ分布 ベータ分布は0から1までの値のみをとる連続型の量的データに用いられる分布です。パラメータ\\(\\alpha\\)と\\(\\beta\\)を用いて表され、確率密度関数は以下の通りになります。なお、\\(B()\\)はベータ関数です。 \\[ P(x) = \\frac{x^{\\alpha-1} (1-x)^{\\beta-1}}{B(\\alpha, \\beta)} \\] 期待値\\(\\bar{p}\\)とshape parameterの\\(\\theta\\)の2つのパラメータで定義され、確率密度関数は以下のようになります。なお、\\(\\theta = \\alpha + \\beta\\)は分布の広さを表し、\\(\\theta\\)が2より大きくなると分布は狭くなり、\\(\\theta\\)が2以下になると0と1に分布が集中していきます。\\(\\theta\\)が2のときは一様分布です。 ベータ分布の期待値と分散は以下のようになります。 期待値: \\(\\frac{\\alpha}{\\alpha + \\beta}\\) 分散: \\(\\frac{\\alpha\\beta}{(\\alpha + \\beta)^2(\\alpha + \\beta + 1)}\\) 様々なベータ分布を書いてみると以下のようになります(図2.5)。 図2.5: 様々なベータ分布 2.5 離散型の確率分布 離散型のデータを対象とする際には、離散型の確率分布を用います。離散型の確率分布は、確率質量関数によって表されます。確率質量関数を\\(f(x)\\)とするとき、確率変数がa以上b以下の値をとる確率は以下のように表されます。確率質量関数も覚える必要はありません。 \\[ \\Sigma_{i = a}^bf(x_i) \\] それでは、実際に連続型の確率分布の例を見ていきましょう。 2.5.1 ベルヌーイ分布 ベルヌーイ分布は0/1、成功/失敗のように2つの結果しか持たない変数を対象とするときに用います。便宜上、一方の結果が得られる確率を成功確率(\\(p\\))と呼びます。成功を1、失敗を0とするとき、確率質量関数は以下のようになります。パラメータは成功確率\\(p\\)のみです。 \\[ \\begin{aligned} &amp;P(x = 1) = p\\\\ &amp;P(x = 0) = 1-p \\end{aligned} \\] 分布の期待値と分散は以下のようになります。 期待値: \\(p\\) 分散: \\(p(1-p)\\) 様々なベルヌーイ分布を書いてみると以下のようになります(図2.6)。 図2.6: 様々なベルヌーイ分布 2.5.2 二項分布 二項分布は、「結果が2通り(例えば、成功/失敗)である試行（ベルヌーイ試行）を独立に\\(n\\)回行ったときの成功回数の分布を表した確率分布」です。つまり、上限のある整数値をとる変数や整数を用いた割合を表す変数に対して用いることができます。例えば、 コインを10回振ったときに表が出る回数は二項分布に従います。 ベルヌーイ試行の成功確率を\\(p\\)とするとき、\\(n\\)回中\\(x\\)回成功する確率\\(p(x)\\)は以下のように書けます。これが二項分布の確率質量関数です。 \\[ P(x) = _n C _x p^x(1-p)^{n-x} \\quad (x \\geq 0) \\] 分布の期待値と分散は以下のようになります。 期待値: \\(np\\) 分散: \\(np(1-p)\\) 様々な二項分布を書いてみると以下のようになります(図2.7)。 図2.7: 様々な二項分布 2.5.3 ベータ二項分布 ベータ二項分布は、二項分布の期待値\\(p\\)が共通のベータ分布から得られると仮定する混合分布です。ベータ二項分布は二項分布よりも裾の広い分布をとることができるので、よりばらつきの大きいデータに対して用いることができます。 確率質量関数はベータ分布のパラメータ\\(\\alpha\\)と\\(\\beta\\)、二項分布のパラメータ\\(n\\)を用いて以下のように書けます。ベータ分布と同様に、\\(\\theta = \\alpha + \\beta\\)は分布の広さを表します。 \\[ P(x) = \\begin{pmatrix} n\\\\x \\end{pmatrix} \\frac{B(x + \\alpha, n - x + \\beta)}{B(\\alpha,\\beta)} \\] ベータ二項分布の期待値と分散は以下のようになります。RでGLMやGLMMを実行するときには、通常平均\\(\\mu\\)と\\(\\theta\\)を用いてモデル化され、推定が行われることが多いです。 期待値: \\(\\mu = \\frac{\\alpha}{\\alpha + \\beta}\\) 分散: \\(n\\frac{\\alpha\\beta}{(\\alpha + \\beta)^2} \\frac{\\alpha + \\beta + n}{\\alpha + \\beta + 1}\\) \\(\\mu\\)と\\(\\theta\\)の値を変えたときの負の二項分布を描いたのが図(fog:ex-bb)です。 二項分布よりも様々な形をとることができることが分かります。 n &lt;- 10 x &lt;- seq(0,10,1) mu &lt;- c(0.2,0.5,0.7) theta &lt;- c(1,4,7) crossing(x,n, mu, theta) %&gt;% mutate(prob = dbetabinom(x, size = n, prob = p, theta = theta)) %&gt;% mutate(mu = str_c(&quot;mu == &quot;, mu), theta = str_c(&quot;theta == &quot;, theta)) %&gt;% ggplot(aes(x = x, y = prob))+ labs(x = &quot;x&quot;, y = &quot;P(x)&quot;)+ scale_x_continuous(breaks = seq(0,15,2))+ geom_col(fill = &quot;lightblue&quot;, color = &quot;black&quot;)+ theme_bw(base_size = 12)+ theme(aspect.ratio = 1)+ facet_rep_grid(theta ~ mu, labeller = label_parsed, scales = &quot;free_x&quot;) 図2.8: 様々なベータ二項分布 2.5.4 ポワソン分布 ポワソン分布は、「ある一定の時間にある事象が発生する回数(\\(x\\))を表す確率分布」です。たとえば、1年間に自動車事故が発生する回数はポワソン分布に従うとされます。二項分布と違い、ポワソン分布は上限のない整数をとる変数に対して用いることができます。 ある事象が起きる平均回数を\\(\\lambda\\)とするとき、その事象が\\(x\\)回生じる確率(\\(P(x)\\))は以下のようになります。これがポワソン分布の確率質量関数です。 \\[ P(x) = \\frac{\\lambda^x}{x!}e^{-\\lambda} \\quad (x \\geq 0) \\] ポワソン分布は期待値も分散も\\(\\lambda\\)になります。様々なポワソン分布を書いてみると以下のようになります(図2.9)。 図2.9: 様々なポワソン分布 2.5.5 負の二項分布 負の二項分布は、ポワソン分布のパラメータ\\(\\lambda\\)が共通のガンマ分布から得られるとする混合分布です。先述のようにポワソン分布は期待値も分散も同じ分布ですが、こうすることにより負の二項分布はポワソン分布よりも裾の広い分布をとることができるので、よりばらつきの大きいデータに対して用いることができます。 負の二項分布の確率質量関数はガンマ分布のパラメータ\\(\\alpha\\)と\\(\\beta\\)を用いて以下のように書けます。\\(\\alpha \\rightarrow \\infty\\)のとき、負の二項分布はポワソン分布になります。 \\[ P(x) = \\frac{\\Gamma(x + \\alpha)}{\\Gamma(\\alpha)x!} \\Bigl(\\frac{\\beta}{1 + \\beta}\\Bigl)^n\\Bigl(\\frac{1}{1 + \\beta}\\Bigl)^x \\] 分布の期待値と分散は以下のようになります。RでGLMやGLMMを実行するときには、通常平均\\(\\mu\\)と\\(\\alpha\\)を用いてモデル化され、推定が行われることが多いです。そのとき、\\(\\alpha\\)は分散パラメータ\\(\\phi\\)と呼ばれます。 期待値: \\(\\mu = \\alpha/\\beta\\) 分散: \\(\\mu + \\mu^2/\\alpha\\) \\(\\mu\\)と\\(\\alpha\\)の値を変えたときの負の二項分布を描いたのが図(fog:ex-nb)です。 ポワソン分布よりも様々な形をとることができることが分かります。 図2.10: 様々な負の二項分布 "],["一般化線形モデルの基礎.html", "3 一般化線形モデルの基礎 3.1 一般化線形モデルとは 3.2 GLMの3要素 3.3 GLMの模式図", " 3 一般化線形モデルの基礎 3.1 一般化線形モデルとは 一般化線形モデル(GLM)は興味の対象である変数(= 応答変数)が、影響を与えると想定される他の変数(= 説明変数)とどのように関連しているのかを調べる分析です。「一般化」とつくのは、GLMがモデルの確率過程として正規分布以外の分布も扱うことができるからです。 3.2 GLMの3要素 GLMは一般に次の3要素で表されます。 確率分布 「応答変数がどのような確率過程で得られているのか」を記述するために必要な部分です。確率分布の詳細については、第2章を参照。応答変数がどのような種類のデータかによって異なる分布を用います。例えば、正の値も負の値も取る連続値(e.g., 気温)ならば正規分布、正の値のみをとる連続値(e.g., 体重)ならばガンマ分布、上限のない正の整数値(e.g., 何かの発生回数)ならばポワソン分布、上限のある整数値や割合データ(e.g., 10回コインを投げて表が出る回数)ならば二項分布を用います。 ある確率分布から確率変数が得られていることを表現するとき、通常\\(\\sim\\)という記号を使います。例えば、応答変数\\(y_i\\)が平均\\(\\mu_i\\)、標準偏差\\(\\sigma\\)の正規分布から得られていると仮定するとき、以下のように書けます。\\(i\\)は何番目のデータであるかを表します。 \\[ y_i \\sim Normal(\\mu_i, \\sigma) \\;\\;\\;(i = 1,2,\\dots, N) \\] 線形予測子 線形予測子とは、説明変数の線形結合したものです。\\(x_1, x_2, \\dots x_n\\)を説明変数とするとき以下のように表されます。\\(\\beta_0\\)は切片(intercept)、\\(\\beta_1, \\dots \\beta_n\\)は回帰係数(coefficient)と呼ばれます。 \\[ \\beta_0 + \\beta_1 \\times x_1 + \\beta_2 \\times x_2 + \\dots \\beta_n \\times x_n \\] リンク関数 応答変数と線形予測子を関連付けるための関数をリンク関数と呼びます。例えば、確率分布の期待値\\(\\mu_i\\)と線形予測子をリンク関数\\(g()\\)で関連付けるとき、以下のように書きます。 \\[ g(\\mu_i) = \\beta_0 + \\beta_1x_{1i} + \\beta_2x_{2i} + \\cdots \\] リンク数の必要性を理解するためには、実際に様々な分布で統計モデルを書いてみるのが一番です。正規分布の場合、通常リンク関数には恒等関数が用いられます。聞きなれないかもしれませんが、恒等関数は入力した値に何も変換を施さない関数です。つまり、正規分布を用いたモデルでは、期待値\\(\\mu_i\\)と線形予測子の関係と、応答変数\\(y_i\\)が得られる確率過程は以下のように書けます((3.1))。 \\[ \\begin{aligned} &amp;y_i \\sim Normal(\\mu_i, \\sigma)\\\\ &amp;\\mu_i = \\beta_0 + \\beta_1x_{1i} + \\beta_2x_{2i} + \\cdots \\end{aligned} \\tag{3.1} \\] これは問題がないでしょう。なぜなら正規分布は\\(-\\infty &lt; y_i &lt; \\infty\\)の値をとることができるので、\\(\\mu_i\\)はどのような値でも取ることができるからです。 しかし、他の分布では話が変わってきます。ここではポワソン分布を用いたモデルを考えてみましょう。例えば、期待値\\(\\lambda\\)と線形予測子を恒等関数で関連付けるとき、以下のように書けます((3.2)))。 \\[ \\lambda_i = \\beta_0 + \\beta_1x_{1i} + \\beta_2x_{2i} + \\cdots \\tag{3.2} \\] 一見これは問題がなさそうですが、ポワソン分布において\\(\\lambda\\)は正の値しか取り得ないことを思い出してください。このままだと上式((3.2))の右辺はどのような値も取り得てしまい、モデルがうまく推定できません。そこで、通常ポワソン分布を用いるときは\\(log()\\)をリンク関数に用います((3.3))。こうすることで、右辺は正の値しか取り得なくなり、うまくモデリングすることができます。これはガンマ分布や負の二項分布を用いるときも同様です。 \\[ \\begin{aligned} &amp;y_i \\sim Poisson(\\lambda_i)\\\\ &amp;log(\\lambda_i) = \\beta_0 + \\beta_1x_{1i} + \\beta_2x_{2i} + \\cdots \\end{aligned} \\tag{3.3} \\] それでは、二項分布を用いる場合はどうでしょう。二項分布は通常パラメータ\\(p\\)と線形予測子を関係づけますが、\\(p\\)は0から1までの値しか取り得ません。そこで、通常二項分布を用いるモデルではロジット関数をリンク関数に用います((3.4))。こうすることで、右辺は0から1の値までしか取り得なくなります。 \\[ \\begin{aligned} &amp;y_i \\sim Binomial(p_i, n_i)\\\\ &amp;logit(p_i) = log \\bigl( \\frac{p_i}{1-p_i} \\bigl) = \\beta_0 + \\beta_1x_{1i} + \\beta_2x_{2i} + \\cdots \\end{aligned} \\tag{3.4} \\] 通常用いられるリンク関数をまとめたのが以下の表です(表3.1)。 表3.1: 各確率分布でよく使われるリンク関数 分布 よく使うリンク関数 正規分布 identity 二項分布 logit ベータ二項分布 logit ポワソン分布 log 負の二項分布 log ガンマ分布 log 3.3 GLMの模式図 以上の3つの要素を使えば、GLMがどのようにモデリングを行っているかを理解することができます。例えば、応答変数が\\(y_i\\)で説明変数が2つ(\\(x_1\\),\\(x_2\\))がある場合を考えます。\\(y_i\\)が上限のない正の整数値をとり、リンク関数をlog関数とするとき、モデルは以下のように書けます。ただし、データ数がNのとき、\\(i = 1,2,\\dots,N\\)です。これがGLMのモデル式です。 \\[ \\begin{aligned} &amp;y_i \\sim Poisson(\\lambda_i)\\\\ &amp;log(\\lambda_i) = \\beta_0 + \\beta_1x_{1i} + \\beta_2x_{2i} \\end{aligned} \\tag{3.5} \\] これを模式的に書くとすると、以下のようになります。モデルでは、各\\(i\\)番目の説明変数(\\(x_{1i},x_{2i}\\))ごとに\\(\\lambda_i\\)の値が決まり、その\\(\\lambda_i\\)をパラメータに持つポワソン分布から応答変数\\(y_i\\)が得られ、それを\\(N\\)番目までやることでデータが得られた、と仮定していることになります。 図3.1: GLMの模式図 "],["実行環境.html", "実行環境", " 実行環境 sessionInfo() ## R version 4.2.2 (2022-10-31 ucrt) ## Platform: x86_64-w64-mingw32/x64 (64-bit) ## Running under: Windows 10 x64 (build 22621) ## ## Matrix products: default ## ## locale: ## [1] LC_COLLATE=Japanese_Japan.utf8 LC_CTYPE=Japanese_Japan.utf8 ## [3] LC_MONETARY=Japanese_Japan.utf8 LC_NUMERIC=C ## [5] LC_TIME=Japanese_Japan.utf8 ## ## attached base packages: ## [1] parallel stats graphics grDevices utils datasets methods ## [8] base ## ## other attached packages: ## [1] rstan_2.32.3 StanHeaders_2.26.28 ## [3] DHARMa.helpers_0.0.0.9000 DHARMa_0.4.6 ## [5] brms_2.20.5 Rcpp_1.0.11 ## [7] rethinking_2.13.2 glmmTMB_1.1.7 ## [9] systemfonts_1.0.4 extrafont_0.18 ## [11] concaveman_1.1.0 ggforce_0.4.1 ## [13] ggdag_0.2.7 dagitty_0.3-1 ## [15] kableExtra_1.3.4 knitr_1.45 ## [17] DT_0.30 patchwork_1.1.2 ## [19] data.table_1.14.6 see_0.7.5.5 ## [21] report_0.5.7.4 parameters_0.20.3 ## [23] performance_0.10.3 modelbased_0.8.6.3 ## [25] insight_0.19.1.4 effectsize_0.8.3.6 ## [27] datawizard_0.7.1.1 correlation_0.8.4 ## [29] bayestestR_0.13.1 easystats_0.6.0.8 ## [31] ggsci_2.9 lemon_0.4.6 ## [33] lubridate_1.9.2 forcats_1.0.0 ## [35] stringr_1.5.0 dplyr_1.1.2 ## [37] purrr_1.0.2 readr_2.1.4 ## [39] tidyr_1.3.0 tibble_3.2.1 ## [41] ggplot2_3.4.4 tidyverse_2.0.0 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.2.0 lme4_1.1-34 ## [4] htmlwidgets_1.6.2 grid_4.2.2 munsell_0.5.0 ## [7] codetools_0.2-18 miniUI_0.1.1.1 withr_2.5.2 ## [10] Brobdingnag_1.2-9 colorspace_2.0-3 highr_0.10 ## [13] rstudioapi_0.15.0 stats4_4.2.2 Rttf2pt1_1.3.12 ## [16] bayesplot_1.10.0 labeling_0.4.3 emmeans_1.8.8 ## [19] polyclip_1.10-4 farver_2.1.1 bridgesampling_1.1-2 ## [22] coda_0.19-4 vctrs_0.6.3 generics_0.1.3 ## [25] TH.data_1.1-2 xfun_0.39 timechange_0.1.1 ## [28] R6_2.5.1 markdown_1.11 cachem_1.0.8 ## [31] promises_1.2.0.1 scales_1.2.1 multcomp_1.4-25 ## [34] gtable_0.3.4 processx_3.8.0 tidygraph_1.2.2 ## [37] sandwich_3.0-2 rlang_1.1.1 splines_4.2.2 ## [40] extrafontdb_1.0 TMB_1.9.6 checkmate_2.1.0 ## [43] inline_0.3.19 yaml_2.3.7 reshape2_1.4.4 ## [46] abind_1.4-5 threejs_0.3.3 crosstalk_1.2.0 ## [49] backports_1.4.1 httpuv_1.6.7 tensorA_0.36.2 ## [52] tools_4.2.2 bookdown_0.35 ellipsis_0.3.2 ## [55] jquerylib_0.1.4 posterior_1.5.0 plyr_1.8.8 ## [58] base64enc_0.1-3 ps_1.7.2 prettyunits_1.2.0 ## [61] zoo_1.8-11 magrittr_2.0.3 colourpicker_1.3.0 ## [64] mvtnorm_1.2-3 matrixStats_0.63.0 hms_1.1.3 ## [67] shinyjs_2.1.0 mime_0.12 evaluate_0.23 ## [70] xtable_1.8-4 shinystan_2.6.0 gridExtra_2.3 ## [73] shape_1.4.6 rstantools_2.3.1.1 compiler_4.2.2 ## [76] V8_4.2.2 crayon_1.5.2 minqa_1.2.5 ## [79] htmltools_0.5.4 later_1.3.0 tzdb_0.3.0 ## [82] RcppParallel_5.1.6 tweenr_2.0.2 MASS_7.3-58.1 ## [85] boot_1.3-28 Matrix_1.6-1 cli_3.6.1 ## [88] igraph_1.3.5 pkgconfig_2.0.3 numDeriv_2016.8-1.1 ## [91] xml2_1.3.5 dygraphs_1.1.1.6 svglite_2.1.1 ## [94] QuickJSR_1.0.5 bslib_0.5.1 webshot_0.5.5 ## [97] estimability_1.4.1 rvest_1.0.3 distributional_0.3.2 ## [100] callr_3.7.3 digest_0.6.31 rmarkdown_2.25 ## [103] curl_4.3.3 shiny_1.7.5.1 gtools_3.9.4 ## [106] nloptr_2.0.3 lifecycle_1.0.4 nlme_3.1-160 ## [109] jsonlite_1.8.4 viridisLite_0.4.2 fansi_1.0.3 ## [112] pillar_1.9.0 lattice_0.20-45 loo_2.6.0 ## [115] fastmap_1.1.1 httr_1.4.7 pkgbuild_1.4.2 ## [118] survival_3.5-5 glue_1.6.2 xts_0.12.2 ## [121] shinythemes_1.2.0 stringi_1.7.12 sass_0.4.7 Bolker, B. M., Brooks, M. E., Clark, C. J., Geange, S. W., Poulsen, J. R., Stevens, M. H. H., &amp; White, J. S. S. (2009). Generalized linear mixed models: A practical guide for ecology and evolution. In Trends in Ecology and Evolution (No. 3; Vol. 24, pp. 127–135). Brooks, M. E., Kristensen, K., van Benthem, K. J., Magnusson, A., Berg, C. W., Nielsen, A., Skaug, H. J., Maechler, M., &amp; Bolker, B. M. (2017). glmmTMB balances speed and flexibility among packages for zero-inflated generalized linear mixed modeling. The R Journal, 9(2), 378–400. https://doi.org/10.32614/RJ-2017-066 Chang, W. (2018). R graphics cookbook: Practical recipes for visualizing data. “O’Reilly Media, Inc.” Dunn, P. K., &amp; Smyth, G. K. (2018). Generalized linear models with examples in R. Springer New York. Fox, G. A., Negrete-Yankelevich, S., &amp; Sosa, V. J. (2015). Ecological statistics: Contemporary theory and application. Oxford University Press. Gelman, A., Hill, J., &amp; Vehtari, A. (2020). Regression and other stories. Cambridge University Press. Harrison, X. A., Donaldson, L., Correa-Cano, M. E., Evans, J., Fisher, D. N., Goodwin, C. E. D., Robinson, B. S., Hodgson, D. J., &amp; Inger, R. (2018). A brief introduction to mixed effects modelling and multi-model inference in ecology. PeerJ, 2018(5). McElreath, R. (2009). Statistical rethinking: A bayeasian course with example in r and stan. CRC Press. Wickham, H., &amp; Grolemund, G. (2016). R for data science: Import, tidy, transform, visualize, and model data. “O’Reilly Media, Inc.” Zuur, A. F. (2009). Mixed effects models and extensions in ecology with R. Springer. 大東健太郎. (2010). 線形モデルから一般化線形モデル（GLM）へ. 雑草研究, 55(4), 268–274. 松村優哉., 湯谷啓明., 紀ノ定保礼., &amp; 前田和. (2021). RユーザのためのRstudio[実践]入門 tidyverseによるモダンな分析フローの世界 改訂2版. 技術評論社. 松浦健太郎. (2012). StanとRでベイズ統計モデリング. 共立出版. 松浦健太郎. (2016). StanとRでベイズ統計モデリング. 共立出版. 馬場真哉. (2015). 平均・分散から始める一般化線形モデル入門. プレアデス出版. 馬場真哉. (2019). RとStanではじめるベイズ統計モデリングによるデータ分析. 講談社. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
